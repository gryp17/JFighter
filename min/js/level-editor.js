function LevelEditor(e){var t=this;this.container=e,this.backgroundContainer=this.container.find(".background-container"),this.controlsContainer=this.container.find(".controls-container"),this.controls=this.container.find(".controls"),this.themeDropdown=this.controls.find(".theme-dropdown"),this.weatherDropdown=this.controls.find(".weather-dropdown"),this.loadLevelDropdown=this.controls.find(".load-level-dropdown"),this.saveLevelButton=this.controls.find(".save-level-button"),this.levelName=this.controls.find(".level-name"),this.canvasHeight=620,this.backgroundImageHeight=this.backgroundContainer.height(),this.heightOffset=this.backgroundImageHeight-this.canvasHeight,this.dragging=!1,this.draggedObject,this.cookieConfig={name:"jfighter-levels",expires:90},this.customLevels={},this.groundObjects={Sherman:{groundDistance:10},Civilian:{groundDistance:24}},this.groundHeight=40,this.init=function(){this.loadCustomLevels(),this.updateCustomLevelsDropdown(),this.backgroundContainer.on("mousewheel",t.scrollBackground),this.themeDropdown.change(t.setLevelTheme),this.controls.find(".game-object").mousedown(t.addGameObject),$("body").on("mousedown",".background-container .game-object",t.selectGameObject),$("body").mouseup(t.dropGameObject),this.container.mousemove(t.dragGameObject),this.loadLevelDropdown.change(t.loadLevel),this.saveLevelButton.click(t.saveLevel),this.levelName.keypress(function(e){13===e.which&&t.saveLevel()}),this.levelName.val("level_"+(new Date).getTime())},this.loadCustomLevels=function(){var e=Cookies.get(this.cookieConfig.name);e?this.customLevels=JSON.parse(e):this.customLevels={},console.log(this.customLevels)},this.updateCustomLevelsDropdown=function(){this.loadLevelDropdown.find("option[disabled!=disabled]").remove(),_.forOwn(this.customLevels,function(e,a){var o=$("<option>",{value:a,text:a});t.loadLevelDropdown.append(o)})},this.setLevelTheme=function(){var e=$(this).val(),a="img/levels/",o=".jpg";t.backgroundContainer.css({backgroundImage:"url("+a+e+o+")"})},this.scrollBackground=function(e){var t=$(document).scrollLeft();$(document).scrollLeft(t+40*e.deltaY),e.preventDefault()},this.addGameObject=function(e){t.draggedObject=$(this).clone(),t.draggedObject.css({position:"absolute"}),t.draggedObject.css({top:e.pageY,left:e.pageX}),$("body").append(t.draggedObject),t.dragging=!0,e.preventDefault()},this.selectGameObject=function(e){t.draggedObject=$(this),t.dragging=!0,e.preventDefault()},this.dropGameObject=function(e){if(t.dragging){if(e.pageY>t.backgroundContainer.height())return;var a=e.pageY,o=e.pageX;if(t.groundObjects[t.draggedObject.attr("data-object")]){var n=t.groundObjects[t.draggedObject.attr("data-object")];a=t.backgroundImageHeight-n.groundDistance-t.draggedObject.height()}if(t.draggedObject.css({top:a,left:o}),!t.draggedObject.has(".remove-btn").length){var i=t.generateGameObjectRemoveButton();t.draggedObject.append(i)}t.draggedObject.appendTo(t.backgroundContainer),t.draggedObject=null,t.dragging=!1}},this.dragGameObject=function(e){t.dragging&&t.draggedObject.css({top:e.pageY,left:e.pageX})},this.clearGameObjects=function(){this.backgroundContainer.find(".game-object").remove()},this.generateGameObjectRemoveButton=function(){return $("<img>",{"class":"remove-btn",src:"img/level-editor/icon-remove.png",title:"Remove",click:function(e){$(this).closest(".game-object").remove(),t.draggedObject=null,t.dragging=!1,e.stopPropagation()}})},this.loadLevel=function(){var e=$(this).val(),a=t.customLevels[e];switch(a||alert("Level Not Found"),t.clearGameObjects(),t.levelName.val(e),t.themeDropdown.val(a.THEME),t.themeDropdown.change(),a.WEATHER.TYPE){case"rain":a.WEATHER.INTERVAL?t.weatherDropdown.val("rain"):t.weatherDropdown.val("heavy-rain");break;case"snow":t.weatherDropdown.val("snow");break;default:t.weatherDropdown.val("default")}var o=a.ENEMIES.concat(a.CIVILIANS);o.forEach(function(e){var a=$("<div>",{"class":"game-object","data-object":e.objectType,title:e.objectType}),o=$("<img>");switch(e.objectType){case"Fighter":o.attr("src","img/enemies/mustang/default/1.png");break;case"Bomber":o.attr("src","img/enemies/b17/default/1.png");break;case"Sherman":o.attr("src","img/enemies/sherman/1.png");break;case"Civilian":o.attr("src","img/civilian/red/2.png")}var n=t.generateGameObjectRemoveButton();a.append(o),a.append(n),a.css({left:e.arguments.x,top:e.arguments.y+t.heightOffset}),t.backgroundContainer.append(a)})},this.saveLevel=function(){var e=[],a=[],o=t.backgroundContainer.find(".game-object"),n=t.levelName.val(),i=t.themeDropdown.val(),r=t.weatherDropdown.val();if(!n||""===n.trim())return void alert("Invalid Level Name");o.each(function(){var o=$(this),n=o.offset(),i=n.left,r=n.top;r-=t.heightOffset;var s={objectType:o.attr("data-object"),arguments:{x:i,y:r}};"Civilian"===o.attr("data-object")?a.push(s):e.push(s)});var s={};switch(r){case"heavy-rain":s.TYPE="rain";break;case"rain":s.TYPE="rain",s.INTERVAL=4096;break;case"snow":s.TYPE="snow";break;default:s.TYPE="normal"}var c={THEME:i,WEATHER:s,GROUND_HEIGHT:t.groundHeight,CIVILIANS:a,ENEMIES:e};t.customLevels[n]=c,Cookies.set(t.cookieConfig.name,t.customLevels,{expires:t.cookieConfig.expires}),t.updateCustomLevelsDropdown(),alert("Level Saved")}}var editor=new LevelEditor($("#container"));editor.init();