function Fighter(t,e,i){this.context=t.contexts.airEnemies.context,this.canvas=t.contexts.airEnemies.canvas,this.models=["MUSTANG","SPITFIRE"],this.model=this.models[_.random(0,this.models.length-1)],this.images=t.images.ENEMIES[this.model],this.stats=t.enemyStats[this.model],this.health=this.stats.HEALTH,this.damaged=!1,this.disabled=!1,this.crashed=!1,this.active=!0,this.dx=t.background.dx-2,this.x=e,this.dy=0,this.y=i,this.angle=0,this.sprite=new Sprite(this.images.SPRITE.DEFAULT,2,!0),this.currentImage=this.sprite.moveTo(_.random(0,this.images.SPRITE.DEFAULT.length-1)),this.shooting=!1,this.burstSize=this.stats.BULLET_BURST_SIZE,this.bulletDelay=this.stats.BULLET_DELAY,this.burstCooldown=this.stats.BULLET_BURST_COOLDOWN,this.delayTimer=0,this.burstTimer=0,this.bulletsShot=0,this.bullets=[],this.draw=function(){this.health<=0&&this.crashed===!1&&this.disabled===!1&&this.disable(),this.damaged===!1&&this.health<this.stats.HEALTH/2&&(this.damaged=!0,this.sprite=new Sprite(this.images.SPRITE.DAMAGED,2,!0)),this.updateSprite(),this.x=this.x+this.dx,this.y=this.y+this.dy,this.disabled===!1?this.engagePlayer():this.crashed===!1&&this.freeFall(),this.updateBulletsStatus(),this.drawFighter(),this.disabled===!1&&this.drawHealthBar(),this.drawBullets()},this.drawHealthBar=function(){var t=Utils.generateHealthBar(this.getHitbox(),this.stats.HEALTH,this.health);this.context.strokeStyle=t.strokeRect.style,this.context.strokeRect(t.x,t.y,t.strokeRect.width,t.strokeRect.height),this.context.fillStyle=t.fillRect.style,this.context.fillRect(t.x,t.y,t.fillRect.width,t.fillRect.height)},this.disable=function(){this.disabled=!0,this.health=0},this.engagePlayer=function(){var e=this.x-t.plane.x+t.plane.currentImage.width,i=this.y+t.background.offset+this.currentImage.height-t.plane.y;e>0&&e<this.canvas.width/1.1?(0>i?this.descend():i>50?this.climb():this.level(),i>-100&&100>i&&this.shoot()):this.level()},this.climb=function(){this.dy>-1*this.stats.CLIMB_SPEED&&(this.dy=this.dy-.1)},this.descend=function(){this.dy<this.stats.DESCEND_SPEED&&(this.dy=this.dy+.1)},this.level=function(){this.dy<0?this.descend():this.dy>0&&this.climb()},this.freeFall=function(){this.dy=this.dy+.05},this.crash=function(){this.y=this.canvas.height-this.currentImage.height-t.background.groundHeight,this.dy=0,this.dx=t.background.dx,this.disabled=!0,this.crashed=!0;var e=this.x-50,i=this.y-10;t.explosions.push(new Explosion(t,e,i,t.background.dx,0,!1))},this.drawFighter=function(){this.dy>0?this.angle=-1*this.dy:this.dy<0?this.angle=-1*this.dy:this.angle=0,this.context.save(),this.context.translate(this.x+this.currentImage.width/2,this.y+t.background.offset+this.currentImage.height/2),this.context.rotate(this.angle*Math.PI/180),this.context.drawImage(this.currentImage,-(this.currentImage.width/2),-(this.currentImage.height/2)),this.context.restore()},this.drawBullets=function(){this.bullets=_.filter(this.bullets,function(t){return t.active===!1?!1:(t.draw(),!0)})},this.updateSprite=function(){this.crashed===!0?this.currentImage=this.images.CRASHED:this.currentImage=this.sprite.move()},this.updateBulletsStatus=function(){this.shooting===!0&&(this.delayTimer++,this.delayTimer>this.bulletDelay&&(this.shooting=!1,this.delayTimer=0)),this.bulletsShot===this.burstSize&&(this.burstTimer++,this.burstTimer>this.burstCooldown&&(this.bulletsShot=0,this.burstTimer=0))},this.shoot=function(){if(this.x<this.canvas.width&&this.disabled===!1&&this.shooting===!1&&this.bulletsShot<this.burstSize){var e=this.x+this.currentImage.width/2,i=this.y+this.currentImage.height/2,s=-25,n=0,h=this.angle;this.shooting=!0,this.dy>0?(h=this.dy,n=this.dy*(h/1.5)):this.dy<0&&(h=this.dy,n=this.dy*(h/1.5)*-1),this.bulletsShot++,this.bullets.push(new Bullet(t,e,i,s,n,h,this))}},this.getHitbox=function(){return{x:this.x,y:this.y,width:this.currentImage.width,height:this.currentImage.height,offset:t.background.offset}}}function Sherman(t,e,i){this.context=t.contexts.groundEnemies.context,this.canvas=t.contexts.groundEnemies.canvas,this.images=t.images.ENEMIES.SHERMAN,this.stats=t.enemyStats.SHERMAN,this.health=this.stats.HEALTH,this.destroyed=!1,this.active=!0,this.dx=t.background.dx-.8,this.x=e,this.dy=0,this.y=i,this.sprite=new Sprite(this.images.SPRITE,2,!0),this.currentImage=this.sprite.moveTo(_.random(0,this.images.SPRITE.length-1)),this.shooting=!1,this.burstSize=this.stats.BULLET_BURST_SIZE,this.bulletDelay=this.stats.BULLET_DELAY,this.burstCooldown=this.stats.BULLET_BURST_COOLDOWN,this.delayTimer=0,this.burstTimer=0,this.bulletsShot=0,this.bullets=[],this.draw=function(){this.updateSprite(),this.x=this.x+this.dx,this.y=this.y+this.dy,this.health<=0&&this.destroyed===!1&&this.destroy(),this.destroyed===!1&&this.engagePlayer(),this.updateBulletsStatus(),this.context.drawImage(this.currentImage,this.x,this.y+t.background.offset),this.destroyed===!1&&this.drawHealthBar(),this.drawBullets()},this.drawHealthBar=function(){var t=Utils.generateHealthBar(this.getHullHitbox(),this.stats.HEALTH,this.health);this.context.strokeStyle=t.strokeRect.style,this.context.strokeRect(t.x,t.y,t.strokeRect.width,t.strokeRect.height),this.context.fillStyle=t.fillRect.style,this.context.fillRect(t.x,t.y,t.fillRect.width,t.fillRect.height)},this.drawBullets=function(){this.bullets=_.filter(this.bullets,function(t){return t.active===!1?!1:(t.draw(),!0)})},this.updateSprite=function(){this.destroyed===!0?this.currentImage=this.images.DESTROYED:this.currentImage=this.sprite.move()},this.engagePlayer=function(){var e=this.x-t.plane.x+t.plane.currentImage.width,i=this.y+t.background.offset+this.currentImage.height-t.plane.y;e>0&&e<this.canvas.width/1.1&&i>200&&500>i&&this.shoot()},this.updateBulletsStatus=function(){this.shooting===!0&&(this.delayTimer++,this.delayTimer>this.bulletDelay&&(this.shooting=!1,this.delayTimer=0)),this.bulletsShot===this.burstSize&&(this.burstTimer++,this.burstTimer>this.burstCooldown&&(this.bulletsShot=0,this.burstTimer=0))},this.shoot=function(){if(this.x<this.canvas.width&&this.destroyed===!1&&this.shooting===!1&&this.bulletsShot<this.burstSize){var e=30,i=this.x+this.currentImage.width-90,s=this.y,n=-15,h=-7;this.shooting=!0,this.bulletsShot++,this.bullets.push(new Bullet(t,i,s,n,h,e,this))}},this.destroy=function(){this.health=0,this.destroyed=!0,this.dx=t.background.dx},this.getHitbox=function(){return{x:this.x,y:this.y,width:this.currentImage.width,height:this.currentImage.height,offset:t.background.offset}},this.getHullHitbox=function(){var t=this.currentImage.width/4,e=this.getHitbox();return e.x=e.x+t,e.width=e.width-t,e}}function Soldier(t,e,i){var s=this;this.context=t.contexts.groundEnemies.context,this.canvas=t.contexts.groundEnemies.canvas,this.images=t.images.ENEMIES.SOLDIER[_.random(0,t.images.ENEMIES.SOLDIER.length-1)],this.stats=t.enemyStats.SOLDIER,this.health=this.stats.HEALTH,this.dead=!1,this.active=!0,this.dx=t.background.dx-.3,this.x=e,this.dy=0,this.y=i,this.sprite=new Sprite(this.images.SPRITE,5,!0),this.currentImage=this.sprite.moveTo(_.random(0,this.images.SPRITE.length-1)),this.reloading=!1,this.bulletDamage=this.stats.DAMAGE,this.bulletCooldown=this.stats.BULLET_COOLDOWN,this.bulletCooldownTimer=0,this.bullets=[],this.draw=function(){this.updateSprite(),this.x=this.x+this.dx,this.y=this.y+this.dy,this.health<=0&&this.dead===!1&&this.die(),this.dead===!1&&this.x<this.canvas.width&&this.engageCivilians(),this.updateBulletsStatus(),this.context.drawImage(this.currentImage,this.x,this.y+t.background.offset),this.dead===!1&&this.drawHealthBar(),this.drawBullets()},this.drawHealthBar=function(){var t=Utils.generateHealthBar(this.getHitbox(),this.stats.HEALTH,this.health);this.context.strokeStyle=t.strokeRect.style,this.context.strokeRect(t.x,t.y,t.strokeRect.width,t.strokeRect.height),this.context.fillStyle=t.fillRect.style,this.context.fillRect(t.x,t.y,t.fillRect.width,t.fillRect.height)},this.drawBullets=function(){this.bullets=_.filter(this.bullets,function(t){return t.active===!1?!1:(t.draw(),!0)})},this.updateSprite=function(){this.dead===!1&&(this.currentImage=this.sprite.move())},this.engageCivilians=function(){t.civilians.forEach(function(t){var e=s.x-t.x+t.currentImage.width;t.dead===!1&&e>0&&600>e&&s.shoot()})},this.updateBulletsStatus=function(){this.reloading===!0&&(this.bulletCooldownTimer++,this.bulletCooldownTimer>this.bulletCooldown&&(this.reloading=!1,this.bulletCooldownTimer=0))},this.shoot=function(){if(this.reloading===!1){var e=this.x,i=this.y+this.currentImage.height/2-10,s=3,n=-20,h=-1;this.reloading=!0,this.bullets.push(new Bullet(t,e,i,n,h,s,this))}},this.die=function(){this.dead=!0,this.y=570,this.dx=t.background.dx,this.currentImage=this.images.DEAD},this.getHitbox=function(){return{x:this.x,y:this.y,width:this.currentImage.width,height:this.currentImage.height,offset:t.background.offset}}}function BombHole(t,e,i){this.context=t.contexts.background.context,this.canvas=t.contexts.background.canvas,this.currentImage=t.images.BOMB_HOLE,this.dx=t.background.dx,this.x=e,this.dy=0,this.y=i,this.angle=_.random(-30,30),this.active=!0,this.draw=function(){this.x=this.x+this.dx,this.y=this.y+this.dy,this.context.save(),this.context.translate(this.x+this.currentImage.width/2,this.y+this.currentImage.height/2),this.context.rotate(this.angle*Math.PI/180),this.context.drawImage(this.currentImage,-(this.currentImage.width/2),-(this.currentImage.height/2)+t.background.offset),this.context.restore()}}function Explosion(t,e,i,s,n,h){this.context=t.contexts.projectiles.context,this.canvas=t.contexts.projectiles.canvas,this.explosionImages=t.images.EXPLOSION,this.dx=s,this.x=e,this.dy=n,this.y=i,this.active=!0,this.spriteDelay=h?5:2,this.sprite=new Sprite(this.explosionImages,this.spriteDelay,!1),this.currentImage,this.draw=function(){this.updateSprite(),this.active&&(this.x=this.x+this.dx,this.y=this.y+this.dy,this.context.drawImage(this.currentImage,this.x,this.y+t.background.offset))},this.updateSprite=function(){this.currentImage=this.sprite.move(),null===this.currentImage&&(this.active=!1)}}function PlaneBomb(t,e,i,s,n){this.context=t.contexts.projectiles.context,this.canvas=t.contexts.projectiles.canvas,this.bombImages=t.images.PROJECTILES.PLANE_BOMB,this.explosionImages=t.images.EXPLOSION,this.dx=s,this.x=e,this.dy=n,this.y=i,this.explosionRadius=t.plane.stats.BOMB_EXPLOSION_RADIUS,this.damage=t.plane.stats.BOMB_DAMAGE,this.sprite=new Sprite(this.bombImages,10,!0),this.currentImage,this.active=!0,this.draw=function(){this.updateSprite(),this.x=this.x+this.dx,this.y=this.y+this.dy,this.context.drawImage(this.currentImage,this.x,this.y+t.background.offset)},this.explode=function(e){this.active=!1;var i=this.x-this.explosionImages[0].width/3,s=this.y-this.explosionImages[0].height/2;t.explosions.push(new Explosion(t,i,s,t.background.dx,0,e)),e&&t.bombHoles.push(new BombHole(t,i,s))},this.updateSprite=function(){this.currentImage=this.sprite.move()},this.getHitbox=function(){return{x:this.x,y:this.y,width:this.currentImage.width,height:this.currentImage.height,offset:t.background.offset}},this.getExplosionHitbox=function(){var t=this.getHitbox();return t.x=t.x-this.explosionRadius,t.width=t.width+2*this.explosionRadius,t}}function Plane(t){this.context=t.contexts.plane.context,this.canvas=t.contexts.plane.canvas,this.stats=t.planeStats[t.selectedPlane],this.images=t.images.PLANES[t.selectedPlane],this.health=this.stats.HEALTH,this.damaged=!1,this.disabled=!1,this.crashed=!1,this.dx=1,this.x=200,this.dy=0,this.y=350,this.angle=0,this.sprite=new Sprite(this.images.SPRITE.DEFAULT,2,!0),this.currentImage=this.images.SPRITE.DEFAULT[0],this.shooting=!1,this.overheat=!1,this.bulletDelay=5,this.bulletTimer=0,this.machinegunHeat=0,this.bullets=[],this.bombing=!1,this.bombCooldown=this.stats.BOMB_COOLDOWN,this.bombDelay=this.stats.BOMB_DELAY,this.loadedBombs=this.stats.MAX_BOMBS,this.bombTimer=0,this.delayTimer=0,this.bombs=[],this.draw=function(){this.health<=0&&this.crashed===!1&&this.disabled===!1&&this.disable(),this.damaged===!1&&this.health<this.stats.HEALTH/2&&(this.damaged=!0,this.sprite=new Sprite(this.images.SPRITE.DAMAGED,2,!0)),this.disabled===!1?this.processInputs(t.inputs):this.crashed===!1&&this.freeFall(),this.updateSprite(),this.updateMachinegunStatus(),this.updateBombsStatus(),this.x=this.x+this.dx,this.y=this.y+this.dy,this.drawPlane(),this.drawBullets(),this.drawBombs()},this.disable=function(){this.disabled=!0,this.health=0},this.freeFall=function(){this.dy=this.dy+.05},this.crash=function(){this.y=this.canvas.height-this.currentImage.height-t.background.groundHeight,this.dy=0,this.dx=t.background.dx,this.disabled=!0,this.crashed=!0,this.health=0;var e=this.x+50,i=this.y-20;t.explosions.push(new Explosion(t,e,i,t.background.dx,0,!1)),t.menu.gameOver()},this.processInputs=function(t){t.UP&&this.dy>-3&&(this.dy=this.dy-.1),t.DOWN&&this.dy<3&&(this.dy=this.dy+.1),t.LEFT&&this.dx>-1&&(this.dx=this.dx-.1),t.RIGHT&&this.dx<this.stats.MAX_SPEED&&(this.dx=this.dx+.1),t.SHOOT&&this.shoot(),t.BOMB&&this.dropBomb()},this.updateSprite=function(){this.crashed===!0?this.currentImage=this.images.CRASHED:this.currentImage=this.sprite.move()},this.drawPlane=function(){this.dy>0?this.angle=this.dy*this.stats.DESCEND_SPEED:this.dy<0?this.angle=this.dy*this.stats.CLIMB_SPEED:this.angle=0,this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this.context.save(),this.context.translate(this.x+this.currentImage.width/2,this.y+this.currentImage.height/2),this.context.rotate(this.angle*Math.PI/180),this.context.drawImage(this.currentImage,-(this.currentImage.width/2),-(this.currentImage.height/2)),this.context.restore()},this.updateMachinegunStatus=function(){this.machinegunHeat===this.stats.MAX_MACHINEGUN_HEAT&&(this.overheat=!0),this.machinegunHeat>0&&(this.machinegunHeat--,this.overheat&&0===this.machinegunHeat&&(this.overheat=!1)),this.shooting===!0&&(this.bulletTimer++,this.machinegunHeat=this.machinegunHeat+this.stats.MACHINEGUN_HEATING,this.machinegunHeat>this.stats.MAX_MACHINEGUN_HEAT&&(this.machinegunHeat=this.stats.MAX_MACHINEGUN_HEAT),this.bulletTimer>this.bulletDelay&&(this.shooting=!1,this.bulletTimer=0))},this.updateBombsStatus=function(){this.loadedBombs<this.stats.MAX_BOMBS&&(this.bombTimer++,this.delayTimer++,this.delayTimer>this.bombDelay&&(this.bombing=!1,this.delayTimer=0),this.bombTimer>this.bombCooldown&&(this.loadedBombs++,this.bombTimer=0))},this.drawBullets=function(){this.bullets=_.filter(this.bullets,function(t){return t.active===!1?!1:(t.draw(),!0)})},this.drawBombs=function(){this.bombs=_.filter(this.bombs,function(t){return t.active?(t.draw(),!0):!1})},this.shoot=function(){if(this.shooting===!1&&this.overheat===!1){var e=this.x+this.currentImage.width/2,i=this.y-t.background.offset+this.currentImage.height/2,s=25,n=0,h=this.angle;this.shooting=!0,this.dy>0?(h=this.dy*this.stats.DESCEND_SPEED,n=this.dy*(h/4.5)):this.dy<0&&(h=this.dy*this.stats.CLIMB_SPEED,n=this.dy*(h/4.5)*-1),"KI84"===t.selectedPlane&&-20>=h&&t.background.offset>0&&(e-=t.background.offset/2.5,i-=t.background.offset/7),this.bullets.push(new Bullet(t,e,i,s,n,h,this))}},this.dropBomb=function(){if(this.loadedBombs>0&&this.bombing===!1){this.bombing=!0,this.loadedBombs--;var e=this.x+this.currentImage.width/1.3,i=this.y-t.background.offset+this.currentImage.height/2,s=this.dx-2,n=(this.dy>0?this.dy:0)+3;this.bombs.push(new PlaneBomb(t,e,i,s,n))}},this.getHitbox=function(){return{x:this.x,y:this.y,width:this.currentImage.width,height:this.currentImage.height,offset:0}}}function Raindrop(t,e,i,s,n,h,a){this.context=t.contexts.weather.context,this.canvas=t.contexts.weather.canvas,this.x=e,this.y=i,this.dx=s,this.dy=n,this.width=h,this.height=a,this.color="rgba(174, 194, 224, 0.5)",this.draw=function(){this.x=this.x+this.dx,this.y=this.y+this.dy,this.context.lineWidth=this.width,this.context.lineCap="round",this.context.strokeStyle=this.color,this.context.beginPath(),this.context.moveTo(this.x,this.y),this.context.lineTo(this.x,this.y+this.height),this.context.stroke()},this.reset=function(){this.x=e,this.y=i,this.dx=s,this.dy=n,this.width=h,this.height=a}}function Snowflake(t,e,i,s,n,h){this.context=t.contexts.weather.context,this.canvas=t.contexts.weather.canvas,this.x=e,this.y=i,this.dx=s,this.dy=n,this.radius=h,this.color="rgba(255, 255, 255, 0.8)",this.draw=function(){this.x=this.x+this.dx,this.y=this.y+this.dy,this.context.fillStyle=this.color,this.context.beginPath(),this.context.arc(this.x,this.y+t.background.offset,this.radius,0,2*Math.PI),this.context.fill()},this.reset=function(){this.x=e,this.y=i,this.dx=s,this.dy=n,this.radius=h}}function BomberBomb(t,e,i,s,n){this.context=t.contexts.projectiles.context,this.canvas=t.contexts.projectiles.canvas,this.bombImages=t.images.PROJECTILES.BOMBER_BOMB,this.explosionImages=t.images.EXPLOSION,this.dx=s,this.x=e,this.dy=n,this.y=i,this.explosionRadius=t.enemyStats.B17.BOMB_EXPLOSION_RADIUS,this.damage=t.enemyStats.B17.BOMB_DAMAGE,this.sprite=new Sprite(this.bombImages,10,!0),this.currentImage,this.active=!0,this.draw=function(){this.updateSprite(),this.x=this.x+this.dx,this.y=this.y+this.dy,this.context.drawImage(this.currentImage,this.x,this.y+t.background.offset)},this.explode=function(e){this.active=!1;var i=this.x-this.explosionImages[0].width/3,s=this.y-this.explosionImages[0].height/2;t.explosions.push(new Explosion(t,i,s,t.background.dx,0,e)),e&&t.bombHoles.push(new BombHole(t,i,s))},this.updateSprite=function(){this.currentImage=this.sprite.move()},this.getHitbox=function(){return{x:this.x,y:this.y,width:this.currentImage.width,height:this.currentImage.height,offset:t.background.offset}},this.getExplosionHitbox=function(){var t=this.getHitbox();return t.x=t.x-this.explosionRadius,t.width=t.width+2*this.explosionRadius,t}}function Bomber(t,e,i){this.context=t.contexts.airEnemies.context,this.canvas=t.contexts.airEnemies.canvas,this.images=t.images.ENEMIES.B17,this.stats=t.enemyStats.B17,this.health=this.stats.HEALTH,this.damaged=!1,this.disabled=!1,this.crashed=!1,this.active=!0,this.dx=t.background.dx-1,this.x=e,this.dy=0,this.y=i,this.angle=0,this.bombing=!1,this.bombCarpetSize=this.stats.BOMB_CARPET_SIZE,this.bombDelay=this.stats.BOMB_DELAY,this.carpetCooldown=this.stats.BOMB_CARPET_COOLDOWN,this.delayTimer=0,this.carpetTimer=0,this.droppedBombs=0,this.bombs=[],this.sprite=new Sprite(this.images.SPRITE.DEFAULT,2,!0),this.currentImage=this.sprite.moveTo(_.random(0,this.images.SPRITE.DEFAULT.length-1)),this.draw=function(){this.health<=0&&this.crashed===!1&&this.disabled===!1&&this.disable(),this.damaged===!1&&this.health<this.stats.HEALTH/2&&(this.damaged=!0,this.sprite=new Sprite(this.images.SPRITE.DAMAGED,2,!0)),this.updateSprite(),this.x=this.x+this.dx,this.y=this.y+this.dy,this.disabled===!1?this.avoidPlayer():this.crashed===!1&&this.freeFall(),this.updateBombsStatus(),this.dropBombs(),this.drawBomber(),this.disabled===!1&&this.drawHealthBar(),this.drawBombs()},this.drawHealthBar=function(){var t=Utils.generateHealthBar(this.getHitbox()[0],this.stats.HEALTH,this.health),e=20;this.context.strokeStyle=t.strokeRect.style,this.context.strokeRect(t.x,t.y-e,t.strokeRect.width,t.strokeRect.height),this.context.fillStyle=t.fillRect.style,this.context.fillRect(t.x,t.y-e,t.fillRect.width,t.fillRect.height)},this.disable=function(){this.disabled=!0,this.health=0},this.freeFall=function(){this.dy<3&&(this.dy=this.dy+.05)},this.crash=function(){this.y=this.canvas.height-this.currentImage.height-t.background.groundHeight,this.dy=0,this.dx=t.background.dx,this.disabled=!0,this.crashed=!0;var e=this.x,i=this.y+50;t.explosions.push(new Explosion(t,e,i,t.background.dx,0,!1))},this.drawBomber=function(){this.dy>0?this.angle=-1*this.dy:this.dy<0?this.angle=-1*this.dy:this.angle=0,this.context.save(),this.context.translate(this.x+this.currentImage.width/2,this.y+t.background.offset+this.currentImage.height/2),this.context.rotate(this.angle*Math.PI/180),this.context.drawImage(this.currentImage,-(this.currentImage.width/2),-(this.currentImage.height/2)),this.context.restore()},this.drawBombs=function(){this.bombs=_.filter(this.bombs,function(t){return t.active?(t.draw(),!0):!1})},this.updateSprite=function(){this.crashed===!0?this.currentImage=this.images.CRASHED:this.currentImage=this.sprite.move()},this.getHitbox=function(){var e={x:this.x,y:this.y+this.currentImage.height/2,width:this.currentImage.width,height:this.currentImage.height/2,offset:t.background.offset},i={x:this.x+270,y:this.y,width:55,height:this.currentImage.height/2,offset:t.background.offset};return[e,i]},this.avoidPlayer=function(){var e=this.x-t.plane.x+t.plane.currentImage.width,i=this.y+t.background.offset+this.currentImage.height-t.plane.y;e>0&&e<this.canvas.width-300&&i>-100?this.climb():this.level()},this.climb=function(){this.dy>-1*this.stats.CLIMB_SPEED&&(this.dy=this.dy-.1)},this.descend=function(){this.dy<this.stats.DESCEND_SPEED&&(this.dy=this.dy+.1)},this.level=function(){this.dy<0?this.descend():this.dy>0&&this.climb()},this.updateBombsStatus=function(){this.bombing===!0&&(this.delayTimer++,this.delayTimer>this.bombDelay&&(this.bombing=!1,this.delayTimer=0)),this.droppedBombs===this.bombCarpetSize&&(this.carpetTimer++,this.carpetTimer>this.carpetCooldown&&(this.droppedBombs=0,this.carpetTimer=0))},this.dropBombs=function(){if(this.x<this.canvas.width&&this.disabled===!1&&this.bombing===!1&&this.droppedBombs<this.bombCarpetSize){var e=this.x+this.currentImage.width/1.5,i=this.y+this.currentImage.height-25,s=this.dx+1,n=2;this.bombing=!0,this.droppedBombs++,this.bombs.push(new BomberBomb(t,e,i,s,n))}}}function BulletImpact(t,e,i){this.context=t.contexts.projectiles.context,this.canvas=t.contexts.projectiles.canvas,this.impactImages=t.images.BULLET_IMPACT,this.active=!0,this.dx=0,this.x=e,this.dy=0,this.y=i,this.impactSprite=new Sprite(this.impactImages,5,!1),this.currentImage,this.draw=function(){this.x=this.x+this.dx,this.y=this.y+this.dy,this.updateSprite(),this.active&&this.context.drawImage(this.currentImage,this.x,this.y+t.background.offset)},this.updateSprite=function(){this.currentImage=this.impactSprite.move(),null===this.currentImage&&(this.active=!1)}}function Bullet(t,e,i,s,n,h,a){this.context=t.contexts.projectiles.context,this.canvas=t.contexts.projectiles.canvas,this.currentImage=t.images.PROJECTILES.BULLET,this.active=!0,this.damage=a.stats.DAMAGE,this.dx=s,this.x=e,this.dy=n,this.y=i,this.angle=h,this.draw=function(){this.x=this.x+this.dx,this.y=this.y+this.dy,this.context.save(),this.context.translate(this.x+this.currentImage.width/2,this.y+this.currentImage.height/2),this.context.rotate(this.angle*Math.PI/180),this.context.drawImage(this.currentImage,-(this.currentImage.width/2),-(this.currentImage.height/2)+t.background.offset),this.context.restore()},this.explode=function(){this.active=!1,t.bulletImpacts.push(new BulletImpact(t,this.x+this.currentImage.width,this.y))},this.getHitbox=function(){return{x:this.x,y:this.y,width:this.currentImage.width,height:this.currentImage.height,offset:t.background.offset}}}function Game(t,e,i,s,n,h){var a=this;this.frameId,this.status,this.images=t,this.planeStats=e,this.enemyStats=i,this.civilianStats=s,this.levelsData=n,this.selectedPlane,this.selectedLevel,this.inputs,this.deadCivilians,this.keyboard=new Keyboard(h),this.collisionsManager=new CollisionsManager(this),this.HUD=new HUD(this,"#HUD"),this.HARPP=new HARPP(this),this.menu=new GameMenu(this),this.contexts={background:new Context("background-canvas"),plane:new Context("plane-canvas"),civilians:new Context("civilians-canvas"),airEnemies:new Context("air-enemies-canvas"),groundEnemies:new Context("ground-enemies-canvas"),projectiles:new Context("projectiles-canvas"),weather:new Context("weather-canvas")},this.start=function(t,e){this.clearFrameId(),this.status=CONSTANTS.GAME_STATE.ACTIVE,this.selectedPlane=t,this.selectedLevel=e,this.deadCivilians=0,this.contexts.background.canvas.focus(),this.background=new Background(this),this.plane=new Plane(this),this.bulletImpacts=[],this.explosions=[],this.bombHoles=[],this.weatherEffects=this.HARPP.generateWeather(this.levelsData[e]),this.enemies=this.levelsData[e].ENEMIES.map(function(t){var arguments=[null,a],e=Object.values(t.arguments);return arguments=arguments.concat(e),new(Function.prototype.bind.apply(this[t.objectType],arguments))}),this.civilians=this.levelsData[e].CIVILIANS.map(function(t){var arguments=[null,a],e=Object.values(t.arguments);return arguments=arguments.concat(e),new(Function.prototype.bind.apply(this[t.objectType],arguments))}),this.keyboard.listen(),this.HUD.show(),this.animate()},this.clearFrameId=function(){this.frameId&&(clearTimeout(this.frameId),window.cancelAnimationFrame(this.frameId),this.frameId=void 0)},this.animate=function(){a.frameId=requestAnimFrame(a.animate),a.status!==CONSTANTS.GAME_STATE.PAUSED&&(a.inputs=a.keyboard.getInputs(),a.collisionsManager.handleCollisions(),a.background.draw(),a.contexts.projectiles.context.clearRect(0,0,a.contexts.projectiles.canvas.width,a.contexts.projectiles.canvas.height),a.plane.draw(),a.contexts.airEnemies.context.clearRect(0,0,a.contexts.airEnemies.canvas.width,a.contexts.airEnemies.canvas.height),a.contexts.groundEnemies.context.clearRect(0,0,a.contexts.groundEnemies.canvas.width,a.contexts.groundEnemies.canvas.height),a.enemies=_.filter(a.enemies,function(t){return t.active?(t.draw(),!0):!1}),0===a.enemies.length&&a.status===CONSTANTS.GAME_STATE.ACTIVE&&a.menu.levelCompleted(),a.contexts.civilians.context.clearRect(0,0,a.contexts.civilians.canvas.width,a.contexts.civilians.canvas.height),a.civilians=_.filter(a.civilians,function(t){return t.active?(t.draw(),!0):!1}),a.bulletImpacts=_.filter(a.bulletImpacts,function(t){return t.active?(t.draw(),!0):!1}),a.explosions=_.filter(a.explosions,function(t){return t.active?(t.draw(),!0):!1}),a.bombHoles=_.filter(a.bombHoles,function(t){return t.active?(t.draw(),!0):!1}),a.contexts.weather.context.clearRect(0,0,a.contexts.weather.canvas.width,a.contexts.weather.canvas.height),a.HARPP.updateWeatherStatus(),a.weatherEffects.forEach(function(t){(a.HARPP.showWeatherEffects||t.y>=0)&&t.draw()}),a.HUD.draw())},window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){window.setTimeout(t,1e3/60)}}()}function Background(t){this.context=t.contexts.background.context,this.canvas=t.contexts.background.canvas,this.backgroundImage=t.images.LEVELS[t.levelsData[t.selectedLevel].THEME],this.dx=-2,this.x=0,this.dy=0,this.groundHeight=t.levelsData[t.selectedLevel].GROUND_HEIGHT,this.y=this.canvas.height-this.backgroundImage.height,this.offset=0,this.draw=function(){this.x=this.x+this.dx,this.y=this.y+this.dy,this.x<-1*this.backgroundImage.width&&(this.x=0),this.moveBackgroundVertically(t.plane),this.y>0&&(this.dy=0,this.y=0),this.y<-1*(this.backgroundImage.height-this.canvas.height)&&(this.dy=0,this.y=-1*(this.backgroundImage.height-this.canvas.height));var e=this.canvas.height-this.backgroundImage.height;this.offset=this.y-e,this.context.drawImage(this.backgroundImage,this.x,this.y),this.context.drawImage(this.backgroundImage,this.x+this.backgroundImage.width,this.y)},this.moveBackgroundVertically=function(t){if(0!==t.dy){var e=this.canvas.height/2;t.y<e&&t.dy<0?this.dy=-1.3*t.dy:t.dy>0&&(this.dy=-1.3*t.dy)}else this.dy=0}}function Civilian(t,e,i){this.context=t.contexts.civilians.context,this.canvas=t.contexts.civilians.canvas,this.images=t.images.CIVILIANS[_.random(0,t.images.CIVILIANS.length-1)],this.healthBarColor="#00D40E",this.dx=t.background.dx-.5,this.x=e,this.dy=0,this.y=i,this.stats=t.civilianStats.CIVILIAN,this.active=!0,this.health=this.stats.HEALTH,this.dead=!1,this.sprite=new Sprite(this.images.SPRITE,7,!0),this.currentImage=this.sprite.moveTo(_.random(0,this.images.SPRITE.length-1)),this.draw=function(){this.health<=0&&this.dead===!1&&this.die(),this.updateSprite(),this.x=this.x+this.dx,this.y=this.y+this.dy,this.context.drawImage(this.currentImage,this.x,this.y+t.background.offset),this.dead===!1&&this.drawHealthBar()},this.drawHealthBar=function(){var t=Utils.generateHealthBar(this.getHitbox(),this.stats.HEALTH,this.health);this.context.strokeStyle=t.strokeRect.style,this.context.strokeRect(t.x,t.y,t.strokeRect.width,t.strokeRect.height),this.context.fillStyle=this.healthBarColor,this.context.fillRect(t.x,t.y,t.fillRect.width,t.fillRect.height)},this.updateSprite=function(){this.dead===!1&&(this.currentImage=this.sprite.move())},this.die=function(){t.deadCivilians++,this.dead=!0,this.y=580,this.dx=t.background.dx,this.currentImage=this.images.DEAD;var e=t.levelsData[t.selectedLevel].CIVILIANS.length,i=t.deadCivilians;i===e&&(t.plane.disable(),t.menu.gameOver())},this.getHitbox=function(){return{x:this.x,y:this.y,width:this.currentImage.width,height:this.currentImage.height,offset:t.background.offset}}}function CollisionsManager(t){var e=this;this.handleCollisions=function(){this.handlePlane(),this.handleBombers(),this.handleBombHoles(),this.handleShermans(),this.handleFighters(),this.handleSoldiers(),this.handleCivilians(),this.handleWeatherEffects()},this.handlePlane=function(){var e=t.plane,i=e.getHitbox(),s=[],n=[],h=[];t.enemies.forEach(function(t){switch(t.constructor){case Bomber:s.push(t);break;case Fighter:n.push(t);break;case Sherman:h.push(t)}}),e.y<0&&(e.y=0,e.dy=0),e.x<0&&e.crashed===!1&&(e.x=0,e.dx=0),e.x+e.currentImage.width>e.canvas.width&&(e.x=e.canvas.width-e.currentImage.width,e.dx=-1),e.y+e.currentImage.height>e.canvas.height-t.background.groundHeight&&e.crashed===!1&&e.crash(),s.forEach(function(t){t.bombs.forEach(function(t){Utils.collidesWith(i,t.getHitbox())&&(e.health=e.health-t.damage,t.explode(!1))})});var a=n.concat(h);a.forEach(function(t){t.bullets.forEach(function(t){Utils.collidesWith(i,t.getHitbox())&&(e.health=e.health-t.damage,t.explode())})}),this.handlePlaneBullets(),this.handlePlaneBombs()},this.handlePlaneBullets=function(){t.plane.bullets.forEach(function(e){e.y>=e.canvas.height-t.background.groundHeight&&e.explode(),e.x>e.canvas.width&&(e.active=!1)})},this.handlePlaneBombs=function(){t.plane.bombs.forEach(function(t){t.x+t.currentImage.width<0&&(t.active=!1),t.y+t.currentImage.height>t.canvas.height-15&&t.explode(!0)})},this.handleBomberBombs=function(e){e.bombs.forEach(function(e){e.x+e.currentImage.width<0&&(e.active=!1),e.y+e.currentImage.height>e.canvas.height-15&&e.explode(!0),t.plane.bullets.forEach(function(t){Utils.collidesWith(e.getHitbox(),t.getHitbox())&&(t.explode(),e.explode(!1))})})},this.handleBombers=function(){var i=_.filter(t.enemies,function(t){return t.constructor===Bomber}),s=t.plane.getHitbox();i.forEach(function(i){var n=i.getHitbox();e.handleBomberBombs(i),i.x<-800&&(i.active=!1),i.y+i.currentImage.height>i.canvas.height-t.background.groundHeight&&i.crashed===!1&&i.crash(),Utils.collidesWith(n,s)&&(i.health--,t.plane.health=t.plane.health-2),t.plane.bullets.forEach(function(t){var e=Utils.collidesWith(n[0],t.getHitbox()),s=Utils.collidesWith(n[1],t.getHitbox());if(e||s){var h=s?2*t.damage:t.damage;i.health=i.health-h,t.explode()}}),t.plane.bombs.forEach(function(t){Utils.collidesWith(n,t.getHitbox())&&(t.explode(!1),i.disable())})})},this.handleBombHoles=function(){t.bombHoles.forEach(function(t){t.x+t.currentImage.width<0&&(t.active=!1)})},this.handleShermans=function(){var i=_.filter(t.enemies,function(t){return t.constructor===Sherman});i.forEach(function(i){var s=i.getHitbox();i.x+i.currentImage.width<0&&(i.active=!1),t.plane.bullets.forEach(function(t){Utils.collidesWith(s,t.getHitbox())&&(i.health=i.health-t.damage,t.explode())}),t.plane.bombs.forEach(function(t){t.active===!1&&Utils.collidesWith(s,t.getExplosionHitbox())&&(i.health=i.health-t.damage,t.explode(!1))}),e.handleShermanBullets(i)})},this.handleShermanBullets=function(t){t.bullets.forEach(function(t){t.x+t.currentImage.width<0&&(t.active=!1)})},this.handleFighters=function(){
var e=this,i=_.filter(t.enemies,function(t){return t.constructor===Fighter}),s=t.plane.getHitbox();i.forEach(function(i){var n=i.getHitbox();i.x<-800&&(i.active=!1),i.y+i.currentImage.height>i.canvas.height-t.background.groundHeight&&i.crashed===!1&&i.crash(),Utils.collidesWith(n,s)&&(i.health=i.health-3,t.plane.health=t.plane.health-2),t.plane.bullets.forEach(function(t){Utils.collidesWith(n,t.getHitbox())&&(i.health=i.health-t.damage,t.explode())}),t.plane.bombs.forEach(function(t){Utils.collidesWith(n,t.getHitbox())&&(t.explode(!1),i.disable())}),e.handleFighterBullets(i)})},this.handleFighterBullets=function(e){e.bullets.forEach(function(e){e.y>=e.canvas.height-t.background.groundHeight&&e.explode(),e.x+e.currentImage.width<0&&(e.active=!1)})},this.handleSoldiers=function(){var i=_.filter(t.enemies,function(t){return t.constructor===Soldier});i.forEach(function(i){var s=i.getHitbox();i.x+i.currentImage.width<0&&(i.active=!1),t.plane.bullets.forEach(function(t){Utils.collidesWith(s,t.getHitbox())&&(i.health=i.health-t.damage,t.explode())}),t.plane.bombs.forEach(function(t){t.active===!1&&Utils.collidesWith(s,t.getExplosionHitbox())&&(i.health=i.health-t.damage,t.explode(!0))}),e.handleSoldierBullets(i)})},this.handleSoldierBullets=function(t){t.bullets.forEach(function(t){t.x+t.currentImage.width<0&&(t.active=!1)})},this.handleCivilians=function(){var e=[],i=[],s=[];t.enemies.forEach(function(t){switch(t.constructor){case Bomber:e.push(t);break;case Sherman:i.push(t);break;case Soldier:s.push(t)}}),t.civilians.forEach(function(n){var h=n.getHitbox();n.x+n.currentImage.width<0&&(n.active=!1);var a=t.plane.bombs;e.forEach(function(t){a=a.concat(t.bombs)}),a.forEach(function(t){n.dead===!1&&t.active===!1&&Utils.collidesWith(h,t.getExplosionHitbox())&&(n.health=n.health-t.damage)});var o=t.plane.bullets;s.forEach(function(t){o=o.concat(t.bullets)}),o.forEach(function(t){n.dead===!1&&Utils.collidesWith(h,t.getHitbox())&&(t.explode(),n.health=n.health-t.damage)}),i.forEach(function(t){n.dead===!1&&Utils.collidesWith(h,t.getHullHitbox())&&n.die()})})},this.handleWeatherEffects=function(){t.weatherEffects.forEach(function(e){e.y>e.canvas.height-t.background.groundHeight&&e.reset()})}}function Context(t){this.canvas=document.getElementById(t),this.context=this.canvas.getContext("2d")}function GameMenu(t){var e=this;$("body").keyup(function(i){27===i.which&&(t.status===CONSTANTS.GAME_STATE.ACTIVE?e.pauseGame():t.status===CONSTANTS.GAME_STATE.PAUSED&&e.hideMenu())}),$("#game-menu .option").each(function(){var i=$(this);i.click(function(){i.hasClass("restart")&&(e.hideMenu(),t.start(t.selectedPlane,t.selectedLevel)),i.hasClass("main-menu")&&location.reload()})}),this.pauseGame=function(){this.showMenu(CONSTANTS.GAME_STATE.PAUSED,"GAME PAUSED")},this.gameOver=function(){this.showMenu(CONSTANTS.GAME_STATE.GAME_OVER,"GAME OVER")},this.levelCompleted=function(){this.showMenu(CONSTANTS.GAME_STATE.LEVEL_COMPLETED,"LEVEL COMPLETED")},this.showMenu=function(e,i){t.status=e,$("#game-menu h4").html(i),$("#game-menu").fadeIn(100)},this.hideMenu=function(){t.status=CONSTANTS.GAME_STATE.ACTIVE,$("#game-menu").fadeOut(100)}}function HARPP(t){this.weather,this.showWeatherEffects=!1,this.clock=0,this.generateWeather=function(t){this.weather=t.WEATHER;var e=[];switch(t.WEATHER.TYPE){case"snow":e=this.generateSnow(t);break;case"rain":e=this.generateRain(t)}return e},this.updateWeatherStatus=function(){this.weather.INTERVAL?(this.clock++,this.clock===this.weather.INTERVAL&&(this.clock=0,this.showWeatherEffects=!this.showWeatherEffects)):this.showWeatherEffects=!0},this.generateSnow=function(e){for(var i=[],s=t.contexts.weather.canvas,n=0;600>n;n++){var h=_.random(0,2*s.width),a=_.random(-1*s.height,0),o=_.random(-4,-2.5,!0),r=_.random(1,2,!0),l=_.random(.5,2.5,!0);i.push(new Snowflake(t,h,a,o,r,l))}return i},this.generateRain=function(e){for(var i=[],s=t.contexts.weather.canvas,n=0;300>n;n++){var h=_.random(0,2*s.width),a=_.random(-1*s.height,0),o=_.random(-4,-2.5,!0),r=_.random(8,10,!0),l=1,c=_.random(5,10);i.push(new Raindrop(t,h,a,o,r,l,c))}return i}}function HUD(t,e){this.element=$(e),this.visible=!1,this.maxHue=130,this.maxPitchHue=200,this.show=function(){this.visible=!0},this.hide=function(){this.visible=!1},this.draw=function(){this.element.css("display",this.visible?"block":"none"),this.visible&&(this.drawHealth(),this.drawThrottle(),this.drawPitch(),this.drawHeat(),this.drawLoadedBombs(),this.drawCiviliansStatus())},this.drawHealth=function(){var e=t.plane.health,i=t.planeStats[t.selectedPlane].HEALTH,s=this.element.find(".health-bar"),n=s.find(".current"),h=s.width()/i,a=this.maxHue/i;n.css({backgroundColor:"hsl("+a*e+", 70%, 50%)",width:e*h})},this.drawThrottle=function(){var e=t.plane.dx+1,i=t.planeStats[t.selectedPlane].MAX_SPEED+1,s=this.element.find(".throttle-bar"),n=s.find(".current"),h=s.width()/i,a=this.maxHue/i,o=this.maxHue-a*e;n.css({backgroundColor:"hsl("+o+", 70%, 50%)",width:e*h})},this.drawPitch=function(){var e,i=t.plane.dy+3,s=6,n=this.element.find(".pitch-bar"),h=n.find(".current"),a=n.height()/s,o=this.maxPitchHue/s;e=i>=s/2?this.maxPitchHue-o*i:o*i,h.css({backgroundColor:"hsl("+e+", 70%, 50%)",height:n.height()-i*a})},this.drawHeat=function(){var e=t.plane.machinegunHeat,i=t.planeStats[t.selectedPlane].MAX_MACHINEGUN_HEAT,s=this.element.find(".heat-bar"),n=s.find("span"),h=s.find(".current"),a=t.plane.overheat?"OVERHEAT":"MACHINEGUN HEAT",o=s.width()/i,r=this.maxHue/i,l=this.maxHue-r*e;h.css({backgroundColor:"hsl("+l+", 70%, 50%)",width:e*o}),n.html(a)},this.drawLoadedBombs=function(){var e=t.plane.loadedBombs,i=t.plane.stats.MAX_BOMBS,s=this.element.find(".loaded-bombs");s.empty();for(var n=0;i>n;n++){var h=$("<img>",{src:"img/hud/bomb_icon.png","class":e>=n+1?"loaded":""});s.append(h)}},this.drawCiviliansStatus=function(){var e=t.levelsData[t.selectedLevel].CIVILIANS.length,i=t.deadCivilians,s=this.element.find(".civilians-status");s.empty();for(var n=0;e>n;n++){var h=$("<img>",{src:"img/hud/running_civilian_icon.png","class":i>=n+1?"dead":""});s.append(h)}}}function ImageRepository(t,e){function i(t){_.forOwn(t,function(t,e){"string"==typeof t?n.totalImages++:i(t)})}function s(t){_.forOwn(t,function(i,h){"string"==typeof i?(t[h]=new Image,t[h].src=i,t[h].onload=function(){n.loadedImages++,n.loadedImages===n.totalImages&&e()}):s(i)})}var n=this;this.images=t,this.loadedImages=0,this.totalImages=0,i(this.images),s(this.images)}function Keyboard(t){var e=this;this.inputs=t,this.getInputs=function(){var t={};return _.forOwn(e.inputs,function(e,i){t[i]=e.status||!1}),t},this.listen=function(){$("body").keydown(function(t){_.forOwn(e.inputs,function(e,i){_.includes(e.keys,t.which)&&(e.status=!0)})}),$("body").keyup(function(t){_.forOwn(e.inputs,function(e,i){_.includes(e.keys,t.which)&&(e.status=!1)})})}}function MainMenu(t){var e=this;this.loadingIndicator=$(".uil-ring-css"),this.mainMenu=$("#main-menu"),this.controlsPopup=this.mainMenu.find(".controls-popup"),this.selectPlaneScreen=this.mainMenu.find(".select-plane"),this.selectLevelScreen=this.mainMenu.find(".select-level"),this.levelsList=this.selectLevelScreen.find(".levels-list"),this.thumbnailContainer=this.levelsList.find(".thumbnail-container"),this.controls,this.controlsMap={LEFT:"BRAKES",RIGHT:"THROTTLE",UP:"ASCEND",DOWN:"DESCEND",SHOOT:"SHOOT",BOMB:"DROP BOMB"},this.gameLevels={GRASSLAND:GRASSLAND,DESERT:DESERT,WINTER:WINTER},this.levelIndex=0,this.selectedPlane,this.selectedLevel,this.showMenu=function(t){this.loadCustomLevels(),this.setCurrentLevel(this.levelIndex),this.mainMenu.find(".controls-button").click(this.openControlsPopup),this.loadCustomControls(),this.controlsPopup.find(".close").click(this.closeControlsPopup),this.controlsPopup.click(function(t){t.target===this&&e.closeControlsPopup()}),this.controlsPopup.find(".reset-controls").click(function(){e.resetControls(),e.buildControlsList()}),this.controlsPopup.find(".save-controls").click(this.saveControls),$("body").on("keydown",".controls-popup input",function(){return!1}),$("body").on("keyup",".controls-popup input",this.setInput),this.mainMenu.find(".plane").click(this.selectPlane),this.levelsList.find(".arrow").click(this.changeLevel),this.levelsList.find(".thumbnail-container").click(function(){e.selectedLevel=$(this).attr("data-level"),e.startGame(t)}),this.selectLevelScreen.find(".start-game-button").click(function(){var i=Object.keys(e.gameLevels);e.selectedLevel=i[e.levelIndex],e.startGame(t)}),this.loadingIndicator.fadeOut(300,function(){e.mainMenu.fadeIn(300)})},this.selectPlane=function(){e.selectedPlane=$(this).attr("data-plane"),e.selectPlaneScreen.fadeOut(100,function(){e.selectLevelScreen.fadeIn(100)})},this.changeLevel=function(){$(this).hasClass("previous")?e.levelIndex--:e.levelIndex++,e.setCurrentLevel(e.levelIndex)},this.setCurrentLevel=function(t){var i=e.thumbnailContainer.find("h2"),s=e.thumbnailContainer.find("img"),n=Object.keys(e.gameLevels);e.levelIndex=t,e.levelIndex>n.length-1?e.levelIndex=0:e.levelIndex<0&&(e.levelIndex=n.length-1);var h=n[e.levelIndex],a=e.gameLevels[h];i.html(h),s.attr("src","img/levels/thumbnails/"+a.THEME.toLowerCase()+".jpg"),e.thumbnailContainer.attr("data-level",h)},this.loadCustomLevels=function(){var t=localStorage.getItem(CONFIG.LOCAL_STORAGE.CUSTOM_LEVELS.NAME);t&&(t=JSON.parse(t),_.forOwn(t,function(t,i){e.gameLevels["[CUSTOM] "+i]=t}))},this.loadCustomControls=function(){var i=localStorage.getItem(CONFIG.LOCAL_STORAGE.CUSTOM_CONTROLS.NAME);i?e.controls=JSON.parse(i):e.controls=_.cloneDeep(t)},this.openControlsPopup=function(){e.loadCustomControls(),e.buildControlsList(),e.controlsPopup.fadeIn(300)},this.closeControlsPopup=function(){e.controlsPopup.fadeOut(300)},this.resetControls=function(){e.controls=_.cloneDeep(t)},this.saveControls=function(){localStorage.setItem(CONFIG.LOCAL_STORAGE.CUSTOM_CONTROLS.NAME,JSON.stringify(e.controls)),e.closeControlsPopup()},this.buildControlsList=function(){var t=e.controlsPopup.find(".controls-list tbody");t.empty(),Object.keys(e.controls).forEach(function(i){var s=$("<tr>"),n=$("<td>",{text:e.controlsMap[i]});s.append(n);for(var h=0;2>h;h++){var a=$("<td>"),o=$("<input>",{"class":i,"data-index":h,type:"text",value:e.keyCodesMap[e.controls[i].keys[h]]||""});a.append(o),s.append(a)}t.append(s)})},this.setInput=function(t){var i=$(this),s=i.attr("class"),n=i.attr("data-index"),h=t.which?t.which:t.keyCode;_.forOwn(e.controls,function(t,e){t.keys=_.filter(t.keys,function(t){return t!==h||e===s})}),27!==h&&8!==h||(h=""),e.controls[s].keys[n]=h,e.buildControlsList()},this.startGame=function(t){e.mainMenu.fadeOut(300,function(){$(".canvas").fadeIn(300)}),t(e.gameLevels,e.controls,e.selectedPlane,e.selectedLevel)},this.keyCodesMap={0:"no keycode",3:"break",8:"backspace / delete",9:"tab",12:"clear",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause/break",20:"caps lock",21:"hangul",25:"hanja",27:"escape",28:"conversion",29:"non-conversion",32:"spacebar",33:"page up",34:"page down",35:"end",36:"home",37:"left arrow",38:"up arrow",39:"right arrow",40:"down arrow",41:"select",42:"print",43:"execute",44:"Print Screen",45:"insert",46:"delete",47:"help",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",58:":",59:"semicolon, equals",60:"<",61:"=",63:"ß",64:"@",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"Windows Key / Left ⌘ / Chromebook Search key",92:"right window key",93:"Windows Menu / Right ⌘",95:"sleep",96:"numpad 0",97:"numpad 1",98:"numpad 2",99:"numpad 3",100:"numpad 4",101:"numpad 5",102:"numpad 6",103:"numpad 7",104:"numpad 8",105:"numpad 9",106:"multiply",107:"add",108:"numpad period",109:"subtract",110:"decimal point",111:"divide",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",124:"f13",125:"f14",126:"f15",127:"f16",128:"f17",129:"f18",130:"f19",131:"f20",132:"f21",133:"f22",134:"f23",135:"f24",144:"num lock",145:"scroll lock",160:"^",161:"!",163:"#",164:"$",165:"ù",166:"page backward",167:"page forward",168:"refresh",169:"closing paren (AZERTY)",170:"*",171:"~ + * key",172:"home key",173:"minus, mute/unmute",174:"decrease volume level",175:"increase volume level",176:"next",177:"previous",178:"stop",179:"play/pause",180:"e-mail",181:"mute/unmute",182:"decrease volume level",183:"increase volume level",186:"semi-colon / ñ",187:"equal sign",188:"comma",189:"dash",190:"period",191:"forward slash / ç",192:"grave accent / ñ / æ / ö",193:"?, / or °",194:"numpad period (chrome)",219:"open bracket",220:"back slash",221:"close bracket / å",222:"single quote / ø / ä",223:"`",224:"left or right ⌘ key",225:"altgr",226:"< /git >, left back slash",230:"GNOME Compose Key",231:"ç",233:"XF86Forward",234:"XF86Back",235:"non-conversion",240:"alphanumeric",242:"hiragana/katakana",243:"half-width/full-width",244:"kanji",255:"toggle touchpad"}}function Sprite(t,e,i){this.images=t,this.delay=e,this.loop=i,this.index=0,this.frames=0,this.currentImage=this.images[this.index],this.move=function(){return this.loop||this.index!==this.images.length-1?(this.frames++,this.frames>this.delay&&(this.index++,_.isUndefined(this.images[this.index])&&(this.index=0),this.currentImage=this.images[this.index],this.frames=0),this.currentImage):(this.currentImage=null,this.currentImage)},this.moveTo=function(t){return this.index=t,this.currentImage=this.images[this.index],this.move()}}var CONFIG={LOCAL_STORAGE:{CUSTOM_LEVELS:{NAME:"jfighter-levels"},CUSTOM_CONTROLS:{NAME:"jfighter-controls"}}},DESERT={THEME:"DESERT",WEATHER:{TYPE:"normal"},GROUND_HEIGHT:40,CIVILIANS:[],ENEMIES:[{objectType:"Bomber",arguments:{x:2700,y:200}},{objectType:"Bomber",arguments:{x:1700,y:300}},{objectType:"Fighter",arguments:{x:1200,y:400}},{objectType:"Fighter",arguments:{x:1200,y:0}},{objectType:"Fighter",arguments:{x:1400,y:100}},{objectType:"Fighter",arguments:{x:1600,y:200}}]},GRASSLAND={THEME:"GRASSLAND",WEATHER:{TYPE:"rain",INTERVAL:4096},GROUND_HEIGHT:40,CIVILIANS:[{objectType:"Civilian",arguments:{x:1075,y:542}},{objectType:"Civilian",arguments:{x:1153,y:542}},{objectType:"Civilian",arguments:{x:1184,y:542}},{objectType:"Civilian",arguments:{x:1249,y:542}},{objectType:"Civilian",arguments:{x:1359,y:542}},{objectType:"Civilian",arguments:{x:1432,y:542}},{objectType:"Civilian",arguments:{x:3674,y:542}},{objectType:"Civilian",arguments:{x:3742,y:542}},{objectType:"Civilian",arguments:{x:3790,y:542}},{objectType:"Civilian",arguments:{x:3641,y:542}},{objectType:"Civilian",arguments:{x:3861,y:542}},{objectType:"Civilian",arguments:{x:6727,y:542}},{objectType:"Civilian",arguments:{x:6798,y:542}},{objectType:"Civilian",arguments:{x:6946,y:542}},{objectType:"Civilian",arguments:{x:8140,y:542}},{objectType:"Civilian",arguments:{x:8200,y:542}},{objectType:"Civilian",arguments:{x:8266,y:542}},{objectType:"Civilian",arguments:{x:8315,y:542}},{objectType:"Civilian",arguments:{x:9259,y:542}},{objectType:"Civilian",arguments:{x:7812,y:542}},{objectType:"Civilian",arguments:{x:7939,y:542}},{objectType:"Civilian",arguments:{x:9539,y:542}},{objectType:"Civilian",arguments:{x:9442,y:542}},{objectType:"Civilian",arguments:{x:9588,y:542}},{objectType:"Civilian",arguments:{x:1480,y:542}},{objectType:"Civilian",arguments:{x:10215,y:542}},{objectType:"Civilian",arguments:{x:10266,y:542}},{objectType:"Civilian",arguments:{x:10188,y:542}},{objectType:"Civilian",arguments:{x:14862,y:542}},{objectType:"Civilian",arguments:{x:14920,y:542}},{objectType:"Civilian",arguments:{x:14768,y:542}},{objectType:"Civilian",arguments:{x:14736,y:542}},{objectType:"Civilian",arguments:{x:15136,y:542}},{objectType:"Civilian",arguments:{x:18161,y:542}},{objectType:"Civilian",arguments:{x:18084,y:542}},{objectType:"Civilian",arguments:{x:18317,y:542}},{objectType:"Civilian",arguments:{x:18365,y:542}},{objectType:"Civilian",arguments:{x:7567,y:542}}],ENEMIES:[{objectType:"Soldier",arguments:{x:18734,y:541}},{objectType:"Soldier",arguments:{x:18759,y:541}},{objectType:"Soldier",arguments:{x:17354,y:541}},{objectType:"Soldier",arguments:{x:17378,y:541}},{objectType:"Soldier",arguments:{x:17542,y:541}},{objectType:"Soldier",arguments:{x:17504,y:541}},{objectType:"Soldier",arguments:{x:17473,y:541}},{objectType:"Soldier",arguments:{x:13601,y:541}},{objectType:"Soldier",arguments:{x:13680,y:541}},{objectType:"Soldier",arguments:{x:13656,y:541}},{objectType:"Soldier",arguments:{x:15780,y:541}},{objectType:"Soldier",arguments:{x:15750,y:541}},{objectType:"Soldier",arguments:{x:15679,y:541}},{objectType:"Soldier",arguments:{x:15635,y:541}},{objectType:"Soldier",arguments:{x:8738,y:541}},{objectType:"Soldier",arguments:{x:8692,y:541}},{objectType:"Soldier",arguments:{x:8650,y:541}},{objectType:"Soldier",arguments:{x:8591,y:541}},{objectType:"Soldier",arguments:{x:7428,y:541}},{objectType:"Soldier",arguments:{x:7381,y:541}},{objectType:"Soldier",arguments:{x:7316,y:541}},{objectType:"Soldier",arguments:{x:5602,y:541}},{objectType:"Soldier",arguments:{x:5684,y:541}},{objectType:"Soldier",arguments:{x:5652,y:541}},{objectType:"Soldier",arguments:{x:2426,y:541}},{objectType:"Soldier",arguments:{x:2380,y:541}},{objectType:"Soldier",arguments:{x:2306,y:541}},{objectType:"Soldier",arguments:{x:2283,y:541}},{objectType:"Soldier",arguments:{x:2238,y:541}},{objectType:"Soldier",arguments:{x:4253,y:541}},{objectType:"Soldier",arguments:{x:4297,y:541}},{objectType:"Soldier",arguments:{x:4344,y:541}},{objectType:"Soldier",arguments:{x:11211,y:541}},{objectType:"Soldier",arguments:{x:11263,y:541}},{objectType:"Soldier",arguments:{x:11164,y:541}},{objectType:"Soldier",arguments:{x:11317,y:541}},{objectType:"Soldier",arguments:{x:12684,y:541}},{objectType:"Soldier",arguments:{x:12740,y:541}},{objectType:"Soldier",arguments:{x:12650,y:541}},{objectType:"Soldier",arguments:{x:12212,y:541}},{objectType:"Soldier",arguments:{x:12168,y:541}},{objectType:"Soldier",arguments:{x:12132,y:541}},{objectType:"Soldier",arguments:{x:19159,y:541}},{objectType:"Soldier",arguments:{x:19109,y:541}},{objectType:"Soldier",arguments:{x:19192,y:541}},{objectType:"Soldier",arguments:{x:18905,y:541}},{objectType:"Soldier",arguments:{x:18935,y:541}},{objectType:"Sherman",arguments:{x:19850,y:540}},{objectType:"Sherman",arguments:{x:19415,y:540}},{objectType:"Sherman",arguments:{x:16279,y:540}},{objectType:"Sherman",arguments:{x:13756,y:540}},{objectType:"Sherman",arguments:{x:8898,y:540}},{objectType:"Sherman",arguments:{x:5788,y:540}},{objectType:"Sherman",arguments:{x:2011,y:540}},{objectType:"Sherman",arguments:{x:13200,y:540}},{objectType:"Fighter",arguments:{x:22331,y:212}},{objectType:"Fighter",arguments:{x:22607,y:355}},{objectType:"Fighter",arguments:{x:20043,y:116}},{objectType:"Fighter",arguments:{x:19755,y:42}},{objectType:"Fighter",arguments:{x:18431,y:246}},{objectType:"Fighter",arguments:{x:18107,y:95}},{objectType:"Fighter",arguments:{x:17750,y:227}},{objectType:"Fighter",arguments:{x:13764,y:199}},{objectType:"Fighter",arguments:{x:13382,y:83}},{objectType:"Fighter",arguments:{x:5951,y:154}},{objectType:"Fighter",arguments:{x:2929,y:50}},{objectType:"Fighter",arguments:{x:3224,y:133}},{objectType:"Fighter",arguments:{x:3505,y:232}},{objectType:"Fighter",arguments:{x:6450,y:192}},{objectType:"Fighter",arguments:{x:6213,y:-3}},{objectType:"Fighter",arguments:{x:10348,y:-82}},{objectType:"Fighter",arguments:{x:10694,y:21}},{objectType:"Bomber",arguments:{x:17673,y:-84}},{objectType:"Bomber",arguments:{x:17202,y:13}},{objectType:"Bomber",arguments:{x:16665,y:131}},{objectType:"Bomber",arguments:{x:13092,y:-74}},{objectType:"Bomber",arguments:{x:14318,y:101}},{objectType:"Bomber",arguments:{x:8682,y:28}},{objectType:"Bomber",arguments:{x:8103,y:-22}},{objectType:"Bomber",arguments:{x:1252,y:128}},{objectType:"Bomber",arguments:{x:5036,y:20}},{objectType:"Bomber",arguments:{x:4003,y:-57}},{objectType:"Bomber",arguments:{x:7579,y:-45}},{objectType:"Bomber",arguments:{x:10910,y:80}},{objectType:"Bomber",arguments:{x:11678,y:-25}},{objectType:"Bomber",arguments:{x:19992,y:-33}},{objectType:"Bomber",arguments:{x:20433,y:131}}]},WINTER={THEME:"WINTER",WEATHER:{TYPE:"snow"},GROUND_HEIGHT:40,CIVILIANS:[{objectType:"Civilian",arguments:{x:1050,y:550}},{objectType:"Civilian",arguments:{x:1080,y:550}},{objectType:"Civilian",arguments:{x:1110,y:550}}],ENEMIES:[{objectType:"Soldier",arguments:{x:1200,y:550}},{objectType:"Soldier",arguments:{x:1300,y:550}},{objectType:"Soldier",arguments:{x:1350,y:550}}]},CIVILIAN_STATS={CIVILIAN:{HEALTH:6}},ENEMY_STATS={B17:{HEALTH:1e3,BOMB_DAMAGE:800,BOMB_CARPET_SIZE:5,BOMB_DELAY:25,BOMB_CARPET_COOLDOWN:200,BOMB_EXPLOSION_RADIUS:100,CLIMB_SPEED:1,DESCEND_SPEED:1},SHERMAN:{HEALTH:1600,DAMAGE:3,BULLET_BURST_SIZE:6,BULLET_DELAY:3,BULLET_BURST_COOLDOWN:100},MUSTANG:{HEALTH:400,DAMAGE:10,BULLET_BURST_SIZE:5,BULLET_DELAY:3,BULLET_BURST_COOLDOWN:50,CLIMB_SPEED:2,DESCEND_SPEED:2},SPITFIRE:{HEALTH:300,DAMAGE:6,BULLET_BURST_SIZE:5,BULLET_DELAY:3,BULLET_BURST_COOLDOWN:40,CLIMB_SPEED:2,DESCEND_SPEED:2},SOLDIER:{HEALTH:50,DAMAGE:3,BULLET_COOLDOWN:200}},PLANE_STATS={BF109:{DAMAGE:60,HEALTH:1200,MAX_SPEED:3,CLIMB_SPEED:7,DESCEND_SPEED:7,MACHINEGUN_HEATING:2,MAX_MACHINEGUN_HEAT:100,BOMB_DAMAGE:1600,BOMB_COOLDOWN:200,BOMB_DELAY:20,MAX_BOMBS:2,BOMB_EXPLOSION_RADIUS:50},STUKA:{DAMAGE:90,HEALTH:2e3,MAX_SPEED:2,CLIMB_SPEED:5,DESCEND_SPEED:15,MACHINEGUN_HEATING:3,MAX_MACHINEGUN_HEAT:250,BOMB_DAMAGE:1700,BOMB_COOLDOWN:100,BOMB_DELAY:10,MAX_BOMBS:4,BOMB_EXPLOSION_RADIUS:60},KI84:{DAMAGE:120,HEALTH:800,MAX_SPEED:4,CLIMB_SPEED:15,DESCEND_SPEED:5,MACHINEGUN_HEATING:2,MAX_MACHINEGUN_HEAT:80,BOMB_DAMAGE:1500,BOMB_COOLDOWN:250,BOMB_DELAY:20,MAX_BOMBS:1,BOMB_EXPLOSION_RADIUS:50}},CONTROLS={LEFT:{keys:[37,65]},RIGHT:{keys:[39,68]},UP:{keys:[38,87]},DOWN:{keys:[40,83]},SHOOT:{keys:[32]},BOMB:{keys:[16]}},GAME_IMAGES={MAIN_MENU:{BACKGROUND:"img/main-menu/menu.png",ARROW:"img/main-menu/arrow.png",ICONS:{EDIT_LEVEL:"img/main-menu/icon-edit-level.png",CONTROLS:"img/main-menu/icon-keyboard.png"}},LEVEL_EDITOR:{ICONS:{REMOVE:"img/level-editor/icon-remove.png"}},PLANES:{BF109:{SPRITE:{DEFAULT:["img/planes/bf109/default/1.png","img/planes/bf109/default/2.png"],DAMAGED:["img/planes/bf109/damaged/1.png","img/planes/bf109/damaged/2.png"]},CRASHED:"img/planes/bf109/crashed.png"},STUKA:{SPRITE:{DEFAULT:["img/planes/stuka/default/1.png","img/planes/stuka/default/2.png"],DAMAGED:["img/planes/stuka/damaged/1.png","img/planes/stuka/damaged/2.png"]},CRASHED:"img/planes/stuka/crashed.png"},KI84:{SPRITE:{DEFAULT:["img/planes/ki84/default/1.png","img/planes/ki84/default/2.png"],DAMAGED:["img/planes/ki84/damaged/1.png","img/planes/ki84/damaged/2.png"]},CRASHED:"img/planes/ki84/crashed.png"}},LEVELS:{GRASSLAND:"img/levels/grassland.jpg",DESERT:"img/levels/desert.jpg",WINTER:"img/levels/winter.jpg"},PROJECTILES:{BULLET:"img/projectiles/bullet.png",PLANE_BOMB:["img/projectiles/plane-bomb/1.png","img/projectiles/plane-bomb/2.png"],BOMBER_BOMB:["img/projectiles/bomber-bomb/1.png","img/projectiles/bomber-bomb/2.png"]},BULLET_IMPACT:["img/projectiles/bullet-impact/1.png","img/projectiles/bullet-impact/2.png","img/projectiles/bullet-impact/3.png"],EXPLOSION:["img/explosion/1.png","img/explosion/2.png","img/explosion/3.png","img/explosion/4.png","img/explosion/5.png","img/explosion/6.png","img/explosion/7.png","img/explosion/8.png","img/explosion/9.png","img/explosion/10.png","img/explosion/11.png","img/explosion/12.png","img/explosion/13.png","img/explosion/14.png","img/explosion/15.png","img/explosion/16.png","img/explosion/17.png","img/explosion/18.png","img/explosion/19.png","img/explosion/20.png","img/explosion/21.png","img/explosion/22.png","img/explosion/23.png","img/explosion/24.png","img/explosion/25.png","img/explosion/26.png","img/explosion/27.png","img/explosion/28.png","img/explosion/29.png","img/explosion/30.png","img/explosion/31.png","img/explosion/32.png","img/explosion/33.png","img/explosion/34.png","img/explosion/35.png","img/explosion/36.png","img/explosion/37.png"],BOMB_HOLE:"img/bomb_hole.png",ENEMIES:{B17:{SPRITE:{DEFAULT:["img/enemies/b17/default/1.png","img/enemies/b17/default/2.png"],DAMAGED:["img/enemies/b17/damaged/1.png","img/enemies/b17/damaged/2.png"]},CRASHED:"img/enemies/b17/crashed.png"},SHERMAN:{SPRITE:["img/enemies/sherman/1.png","img/enemies/sherman/2.png"],DESTROYED:"img/enemies/sherman/destroyed.png"},MUSTANG:{SPRITE:{DEFAULT:["img/enemies/mustang/default/1.png","img/enemies/mustang/default/2.png"],DAMAGED:["img/enemies/mustang/damaged/1.png","img/enemies/mustang/damaged/2.png"]},CRASHED:"img/enemies/mustang/crashed.png"},SPITFIRE:{SPRITE:{DEFAULT:["img/enemies/spitfire/default/1.png","img/enemies/spitfire/default/2.png"],DAMAGED:["img/enemies/spitfire/damaged/1.png","img/enemies/spitfire/damaged/2.png"]},CRASHED:"img/enemies/spitfire/crashed.png"},SOLDIER:[{SPRITE:["img/enemies/soldier/light/1.png","img/enemies/soldier/light/2.png","img/enemies/soldier/light/3.png","img/enemies/soldier/light/4.png","img/enemies/soldier/light/5.png"],DEAD:"img/enemies/soldier/light/6.png"},{SPRITE:["img/enemies/soldier/dark/1.png","img/enemies/soldier/dark/2.png","img/enemies/soldier/dark/3.png","img/enemies/soldier/dark/4.png","img/enemies/soldier/dark/5.png"],DEAD:"img/enemies/soldier/dark/6.png"}]},CIVILIANS:[{SPRITE:["img/civilian/green/1.png","img/civilian/green/2.png","img/civilian/green/3.png","img/civilian/green/4.png","img/civilian/green/5.png","img/civilian/green/6.png","img/civilian/green/7.png","img/civilian/green/8.png"],DEAD:"img/civilian/green/9.png"},{SPRITE:["img/civilian/blue/1.png","img/civilian/blue/2.png","img/civilian/blue/3.png","img/civilian/blue/4.png","img/civilian/blue/5.png","img/civilian/blue/6.png","img/civilian/blue/7.png","img/civilian/blue/8.png"],DEAD:"img/civilian/blue/9.png"},{SPRITE:["img/civilian/red/1.png","img/civilian/red/2.png","img/civilian/red/4.png","img/civilian/red/5.png","img/civilian/red/6.png","img/civilian/red/7.png","img/civilian/red/8.png"],DEAD:"img/civilian/red/9.png"}],HUD:{BOMB_ICON:"img/hud/bomb_icon.png"}},CONSTANTS={GAME_STATE:{ACTIVE:1,PAUSED:2,GAME_OVER:3,LEVEL_COMPLETED:4}},IMAGE_REPOSITORY=new ImageRepository(GAME_IMAGES,function(){var t=new MainMenu(CONTROLS);t.showMenu(function(t,e,i,s){var n=new Game(IMAGE_REPOSITORY.images,PLANE_STATS,ENEMY_STATS,CIVILIAN_STATS,t,e);n.start(i,s)})}),Utils=new function(){function t(t){return t.left=t.x,t.top=t.y+t.offset,t.right=t.left+t.width,t.bottom=t.top+t.height,t}var e=this;this.intersect=function(e,i){var s=!1;e=t(e),i=t(i);var n=Math.max(0,Math.min(e.right,i.right)-Math.max(e.left,i.left)),h=Math.max(0,Math.min(e.bottom,i.bottom)-Math.max(e.top,i.top));return 0!==n&&0!==h&&(s=!0),s},this.collidesWith=function(t,i){var s=!1;return t.constructor!==Array&&(t=[t]),i.constructor!==Array&&(i=[i]),t.forEach(function(t){i.forEach(function(i){e.intersect(t,i)&&(s=!0)})}),s},this.generateHealthBar=function(t,e,i){var s=50,n=5,h="black",a="red",o=0,r=5;s>t.width?s=t.width:o=(t.width-s)/2;var l=s/e;return{x:t.x+o,y:t.y+t.offset-r,strokeRect:{style:h,width:s,height:n},fillRect:{style:a,width:l*i,height:n}}}};